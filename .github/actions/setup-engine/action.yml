name: 'Setup Profile Engine'
description: 'Install Profile Engine CLI and dependencies'

inputs:
  python-version:
    description: 'Python version to use'
    required: false
    default: '3.11'

runs:
  using: 'composite'
  steps:
    - name: ğŸ Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python-version }}
        cache: 'pip'
        cache-dependency-path: |
          **/requirements*.txt
          **/pyproject.toml
          engine/pyproject.toml
    
    - name: ğŸ“¦ Install system dependencies
      shell: bash
      run: |
        sudo apt-get update
        sudo apt-get install -y jq curl bc
    
    - name: ğŸ“¦ Install Profile Engine
      shell: bash
      run: |
        python -m pip install --upgrade pip
        pip install -e ./engine
        echo "âœ… Profile Engine installed"
        profile-engine --version
    
    - name: ğŸ“¦ Install legacy dependencies (for backward compatibility)
      shell: bash
      run: |
        if [ -f requirements.txt ]; then
          pip install -r requirements.txt
        fi
        echo "âœ… Legacy dependencies installed"
