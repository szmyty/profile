# Demo workflow for testing act locally
# This workflow is designed to work well with act for demonstration purposes
# It doesn't use composite actions and has minimal dependencies

name: act Demo - Simple Workflow

on:
  workflow_dispatch:
  push:
    branches:
      - main
      - 'feature/**'

permissions:
  contents: read

jobs:
  # Simple job that lists files
  list-files:
    name: List Repository Files
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: List workflows
        run: |
          echo "=== GitHub Workflows ==="
          ls -lh .github/workflows/
      
      - name: List scripts
        run: |
          echo "=== Python Scripts ==="
          ls -lh scripts/*.py | head -10
      
      - name: Show repository structure
        run: |
          echo "=== Repository Root ==="
          ls -lh | grep -E "^d" || true

  # Test environment and dependencies
  check-environment:
    name: Check Environment
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Check Python version
        run: |
          python --version
          pip --version
      
      - name: Check installed packages
        run: |
          pip list | grep -E "pytest|jsonschema|pillow" || echo "Packages not installed yet"
      
      - name: Install dependencies
        run: |
          pip install -q jsonschema pillow pytest
          echo "✅ Dependencies installed"
      
      - name: Verify installations
        run: |
          python -c "import jsonschema; print(f'jsonschema: {jsonschema.__version__}')"
          python -c "import PIL; print(f'Pillow: {PIL.__version__}')"
          python -c "import pytest; print(f'pytest: {pytest.__version__}')"

  # Simple Python test
  run-simple-test:
    name: Run Simple Python Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install test dependencies
        run: |
          pip install -q pytest jsonschema
      
      - name: Run basic validation
        run: |
          echo "Testing JSON validation..."
          if [ -f "config/theme.json" ]; then
            python -c "import json; json.load(open('config/theme.json'))" && echo "✅ theme.json is valid"
          fi
          
          if [ -f "pyproject.toml" ]; then
            echo "✅ pyproject.toml exists"
          fi
      
      - name: Count test files
        run: |
          echo "Test files found:"
          find tests -name "test_*.py" -o -name "test_*.sh" | wc -l

  # Demonstrate environment variables
  test-environment-vars:
    name: Test Environment Variables
    runs-on: ubuntu-latest
    env:
      CUSTOM_VAR: "Hello from act!"
      REPO_NAME: ${{ github.repository }}
    steps:
      - name: Show GitHub context
        run: |
          echo "Repository: ${{ github.repository }}"
          echo "Actor: ${{ github.actor }}"
          echo "Event: ${{ github.event_name }}"
          echo "Ref: ${{ github.ref }}"
          echo "SHA: ${{ github.sha }}"
      
      - name: Show custom variables
        run: |
          echo "Custom variable: $CUSTOM_VAR"
          echo "Repo name: $REPO_NAME"
      
      - name: Show act-specific
        run: |
          if [ "$ACT" = "true" ]; then
            echo "✅ Running in act (local execution)"
          else
            echo "Running in GitHub Actions"
          fi

  # Summary job
  summary:
    name: Workflow Summary
    runs-on: ubuntu-latest
    needs: [list-files, check-environment, run-simple-test, test-environment-vars]
    if: always()
    steps:
      - name: Summary
        run: |
          echo "================================"
          echo "  act Demo Workflow Complete"
          echo "================================"
          echo ""
          echo "✅ All jobs completed"
          echo ""
          echo "This workflow demonstrates:"
          echo "  • Basic checkout and setup"
          echo "  • Python environment configuration"
          echo "  • Environment variable access"
          echo "  • Multi-job dependencies"
          echo ""
          echo "Run locally with:"
          echo "  act -W .github/workflows/act-demo.yml"
          echo ""
